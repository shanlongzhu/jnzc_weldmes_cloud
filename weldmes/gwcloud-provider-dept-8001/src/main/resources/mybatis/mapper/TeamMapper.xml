<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gw.data.team.dao.TeamDao">

	<resultMap id="weldStatisticsData" type="com.gw.entities.WeldStatisticsData">
		<id property="id"  column="id"></id>
		<result property="weldModel" column="weldModel"></result>
		<result property="gatherNo" column="gatherNo"></result>
		<result property="welderNo" column="welderNo"></result>
		<result property="weldStatus" column="weldStatus"></result>
		<result property="weldDuration" column="weldDuration"></result>
		<result property="machineId" column="machineId"></result>
		<result property="machineNo" column="machineNo"></result>
		<result property="machineDeptId" column="machineDeptId"></result>
		<result property="gatherId" column="gatherId"></result>
		<result property="gatherDeptId" column="gatherDeptId"></result>
		<result property="welderId" column="welderId"></result>
		<result property="welderName" column="welderName"></result>
		<result property="welderDeptId" column="welderDeptId"></result>
		<result property="taskId" column="taskId"></result>
		<result property="taskName" column="taskName"></result>
		<result property="taskNo" column="taskNo"></result>
		<result property="createTime" column="createTime"></result>
		<result property="startTime" column="startTime"></result>
		<result property="endTime" column="endTime"></result>
		<result property="electricity" column="electricity"></result>
		<result property="voltage" column="voltage"></result>
		<result property="wireFeedRate" column="wireFeedRate"></result>
		<result property="wireDiameter" column="wireDiameter"></result>
		<result property="wireMaterialsGases" column="wireMaterialsGases"></result>
		<result property="count" column="count"></result>
		<result property="count2" column="count2"></result>
		<result property="count3" column="count3"></result>
		<result property="count4" column="count4"></result>
		<result property="count5" column="count5"></result>
		<result property="utilization" column="utilization"></result>
		<result property="time" column="time"></result>
		<result property="time2" column="time2"></result>
		<result property="utilization2" column="utilization2"></result>
		<association property="sysDept" javaType="com.gw.entities.SysDept">
			<id property="id" column="id"></id>
			<result property="name" column="name"></result>
		</association>
		<association property="machineWeldInfo" javaType="com.gw.entities.MachineWeldInfo">
			<id property="id"  column="id"></id>
			<result property="machineNo" column="machine_no"></result>
			<result property="status" column="status"></result>
			<result property="type" column="type"></result>
			<result property="firm" column="firm"></result>
			<result property="model" column="model"></result>
			<result property="deptId" column="dept_id"></result>
			<result property="gId" column="g_id"></result>
			<result property="isNetwork" column="is_network"></result>
			<result property="createTime" column="create_time"></result>
		</association>
	</resultMap>


	<select id="getList" resultMap="weldStatisticsData">
		select
			a.*,
			b.*,
			c.*,
			d.*,
			e.*,
			f.*,
			g.*,
			cast(b.count2 / a.count * 100 as decimal (13,2)) utilization,
			cast(f.time/g.time2*100 as decimal (13,2)) utilization2
		from
			(
				select
					count( machineId ) count,
		s.`name`,
		s.id
				from
					weld_statistics_data w,
					sys_dept s
				where
					w.machineDeptId = s.id
				  and
					w.startTime &gt;= #{time1} and w.endTime &lt;= #{time2}
				group by
					machineDeptId
			) a,
			(
				select
					count( m.id ) count2,
					s.`name`
				from
					machine_weld_info m,
					sys_dept s
				where
					m.dept_id = s.id
				group by
					s.`name`
			) b,(
				select
					count( w.id ) count3,
					s.`name`
				from
					weld_statistics_data w,
					sys_dept s
				where
					w.machineDeptId = s.id
				  and ( w.weldStatus = 3 or w.weldStatus = 5 or w.weldStatus = 7 or w.weldStatus = 99 )
				group by
					s.`name`
			) c,(
				select distinct
					count(w.machineId) count4,
					s.`name`
				from
					weld_statistics_data w,
					sys_dept s
				where
					w.taskId = 0
				  and w.machineDeptId=s.id
				group by
					s.`name`
			) d,(
				select distinct
					count(w.machineId) count5,
					s.`name`
				from
					weld_statistics_data w,
					sys_dept s
				where
					w.taskId != 0
		and w.machineDeptId=s.id
				group by
					s.`name`
			)e,(
				select
					SEC_TO_TIME(count( w.id )) time,
		s.`name`
				from
					weld_statistics_data w,
					sys_dept s
				where
					w.machineDeptId = s.id
				  and ( w.weldStatus = 3 or w.weldStatus = 99 )
				group by
					s.`name`
			)f,(
				select
					SEC_TO_TIME(count( w.id )) time2,
					s.`name`
				from
					weld_statistics_data w,
					sys_dept s
				where
					w.machineDeptId = s.id
				  and ( w.weldStatus = 0 or w.weldStatus = 3 or w.weldStatus = 5 or w.weldStatus = 7 or w.weldStatus = 99 )
				group by
					s.`name`
			)g
		where
			a.`name` = b.`name`
		  and a.`name` = c.`name`
		  and a.`name`=d.`name`
		  and a.name=e.name
		  and a.`name`=f.`name`
		  and a.`name`=g.`name`
	</select>

</mapper>