<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.gw.process.solderer.dao.SoldererDao">

    <resultMap id="solderer" type="com.gw.entities.WelderInfo">
        <id property="id"  column="id"></id>
        <result property="welderName" column="welder_name"></result>
        <result property="welderNo" column="welder_no"></result>
        <result property="deptId" column="dept_id"></result>
        <result property="gender" column="gender"></result>
        <result property="cellphone" column="cellphone"></result>
        <result property="rank" column="rank"></result>
        <result property="certification" column="certification"></result>
        <result property="remarks" column="remarks"></result>
        <result property="status" column="status"></result>
        <association property="sysDictionary" javaType="com.gw.entities.SysDictionary">
            <id property="id" column="id"></id>
            <result property="valueName" column="value_name"></result>
            <result property="valueNames" column="value_names"></result>
        </association>
        <association property="sysDept" javaType="com.gw.entities.SysDept">
            <id property="id" column="id"></id>
            <result property="name" column="name"></result>
        </association>
    </resultMap>

    <select id="getList" resultMap="solderer">
        select w.id,w.welder_name,w.cellphone,w.welder_no,w.remarks,w.dept_id,w.rank,w.dept_id,
	           w.certification,d.value_name,dic.value_name value_names,s.`name`,d.id,dic.id,s.id
        from welder_info w
	    left join sys_dictionary d on w.rank	= d.id
	    left join sys_dictionary dic on w.certification = dic.id
	    left join sys_dept s on w.dept_id = s.id
        where 1=1
        <if test="welderName != null and welderName != ''">
            and  w.welder_name = #{welderName}
        </if>
        <if test="welderNo != null and welderNo != ''">
            and  w.welder_no = #{welderNo}
        </if>
        <if test="rate != null and rate != ''">
            and  d.id = #{rate}
        </if>
        <if test="talent != null and talent != ''">
            and  dic.id = #{talent}
        </if>
        <if test="grade != null and grade != ''">
            and  s.id = #{grade}
        </if>
    </select>

    <insert id="addSolderer">
        insert into welder_info(welder_no,welder_name,cellphone,rank,certification,dept_id,remarks)
        values (#{welderInfo.welderNo},#{welderInfo.welderName},#{welderInfo.cellphone},
                #{welderInfo.rank},#{welderInfo.certification},#{welderInfo.deptId},#{welderInfo.remarks})
        ON DUPLICATE KEY UPDATE
         welder_no = #{welderInfo.welderNo},
         welder_name = #{welderInfo.welderName},
         cellphone = #{welderInfo.status},
         rank = #{welderInfo.rank},
         certification = #{welderInfo.certification},
         dept_id = #{welderInfo.deptId},
         remarks = #{welderInfo.remarks}
    </insert>

    <select id="getById" resultType="com.gw.entities.WelderInfo">
    select id,welder_name,cellphone,welder_no,remarks,rank,certification,dept_id
    from welder_info
    where id =#{id}
    </select>

    <update id="updateSolderer">
        update welder_info
        <trim prefix="set" suffixOverrides=",">
            <if test="welderNo != null and welderNo !=''">welder_no=#{welderNo},</if>
            <if test="welderName != null and welderName !=''">welder_name=#{welderName},</if>
            <if test="rank != null and rank !=''">rank=#{rank},</if>
            <if test="certification != null and certification !=''">certification=#{certification},</if>
            <if test="deptId != null and deptId !=''">dept_id=#{deptId},</if>
            cellphone=#{cellphone},
            remarks=#{remarks}
        </trim>
        where id=#{id}
    </update>

    <delete id="deleteSolderer">
        delete from welder_info where id=#{id}
    </delete>

    <select id="getRankId" resultType="java.lang.Byte">
        select id from sys_dictionary where value_name=#{rank}
    </select>

    <select id="getCertificationId" resultType="java.lang.Byte">
         select id from sys_dictionary where value_name=#{certification}
    </select>

    <select id="getDeptId" resultType="java.lang.Long">
        select id from sys_dept where name=#{deptName}
    </select>

    <insert id="save">
        insert into welder_info(welder_no,welder_name,cellphone,rank,certification,dept_id,remarks)
        values (#{welderInfo.welderNo},#{welderInfo.welderName},#{welderInfo.cellphone},
                #{welderInfo.rank},#{welderInfo.certification},#{welderInfo.deptId},#{welderInfo.remarks})
        ON DUPLICATE KEY UPDATE
         welder_no = #{welderInfo.welderNo},
         welder_name = #{welderInfo.welderName},
         cellphone = #{welderInfo.status},
         rank = #{welderInfo.rank},
         certification = #{welderInfo.certification},
         dept_id = #{welderInfo.deptId},
         remarks = #{welderInfo.remarks}
    </insert>

    <!--获取历史曲线中焊工id、姓名以及编号-->
    <select id="selectHistoryWelderInfos" resultType="com.gw.entities.WelderInfo">
        select id,welder_name welderName,welder_no welderNo from welder_info
    </select>

    <!--判断焊工编号是否存在-->
    <select id="judgeWelderNoYesOrNo" resultType="java.lang.Integer">
        select (1) from welder_info where welder_no = #{WelderNo} and id != #{id}
    </select>

</mapper>
